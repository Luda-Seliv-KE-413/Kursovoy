:imagesdir: images
:toc: macro
:icons: font
:figure-caption: Рисунок
:table-caption: Таблица
:stem: Формула


== Дизайн

=== Настройка подключения датчика температуры

//Если брать установленный на дополнительной плате датчик температуры:
* Подключить датчик температуры к интерфейсу I2C.
* Включить внутренний АЦП (удатчика).
* При использовании серверов LM75 в качестве подчиненного устройства спользуется 7-разрядный адрес подчиненного устройства.

[#7-разрядный адрес]
.7-разрядный адрес
image::dlay temp.png[]

Пины А2/А1/А0 этогомодуля подключены к земле поэтому адрес подчиненного устройства здесь равен 0х48.
//****************************************************

Для подключения прецизионного термочувствительного кварцевого резонатора необъодимо:

* что-то

=== Настройка подключения таймперов TIM2 и TIM5

* Таймер 5 тактируется от шины APB1.

* Подключение к системе тактирование выполняется через регистр APB1ENR модуля RCC.

* Входную частоту таймера можно поделить, записав делитель частоты в решистр PSC.

* Включение таймера производиться с помощью бита CEN в регистре CR1 модуля таймера.

//На каждый отчсет таймера по умолчанию происходит на частоте шины, т.е. если шина APB1 работает на частоте 1 Мгц, то один отсчет таймера произойдет через 1 мкс. Таким образом можно организовать измерение времени с разрешением в 1 мкс.

* Подключение к системе тактирование выполняется через регистр APB1ENR модуля RCC.

* Входную частоту таймера можно поделить, записав делитель частоты в решистр PSC.

* Включение таймера производиться с помощью бита CEN в регистре CR1 модуля таймера.

=== Настройка подключения интерфейса USART2 для Bluetooth

* Подключить USART к источнику тактирования – устанавливаем бит USART2EN в регистре APB1ENR (АЦП тактируется от матрицы шин APB1).​
* Необходимо сконфигурировать порты. Настроить порты, на альтернативную функцию нужного модуля USART​
* Настроить формат передачи байт, с помощью регистра CR1 и CR2​
* Задать скорость передачи с помощью регистра BRR​
* Разрешить передачу помощью бита TE и если надо прием, с помощью бита RE в модуле USART с помощью регистра CR1​
* Включить сам модуль USART битом UE  в регистре CR1​
* Если работаем через прерывание, то разрешить глобальное прерывание для нужного USART, в регистре ISER[1] модуля NVIC​
* Если работаем через прерывание, в зависимости от того, что нам нужно, разрешить прерывание по сигналу модуля UART (например,
  от сигнала регистр данных передачика пуст (бит TXEIE в регистре CR1))


=== Архитектура
По полученным результатам анаализа требований была составлена архитектура программного обеспечения устройства.

[#Основная UML-диаграмма]
.Основная UML-диаграмма
[plantuml,format=png]
....
include::Diagram.puml[]
....

[#UML-диаграмма измерения частоты]
.UML-диаграмма измерения частоты
[plantuml,format=png]
....
include::PodDiagram.puml[]
....